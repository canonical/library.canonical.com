{% extends 'base_layout.html' %}
{% block title %}Canonical Reference Library | Canonical{% endblock %}

{% block description %}
Canonical Reference Library is single source of information for all corporate knowledge with Canonical
{% endblock %}

{% block meta_copydoc %}{% endblock %}

{% block content %}
{% macro create_navigation(nav_items, previous_slug, expandable=False, expanded=False) %}
  {% if nav_items %}
    <ul class="p-side-navigation__list" {% if expanded %}aria-expanded="true"{% endif %}>
      {% for element in nav_items %}
        {% if (nav_items[element].mimeType == "document" and not nav_items[element].name|lower == "index") or (nav_items[element].children and nav_items[element].mimeType == "folder") %}
          <li class="p-side-navigation__item">
            {% if nav_items[element].mimeType == "document" %}
              <a
                class="p-side-navigation__link {% if nav_items[element].children %}is-expandable{% endif %}" {% if nav_items[element].active %}aria-current="page"{% endif %}
                href="/{{previous_slug}}/{{nav_items[element].slug}}"
              >{{ nav_items[element].name }}</a>
            {% elif nav_items[element].children %}
              {% if nav_items[element]["children"]["index"] %}
                <a 
                  class="p-side-navigation__link is-expandable u-no-margin--bottom" 
                  href="/{{previous_slug}}/{{nav_items[element].slug}}" 
                  {% if nav_items[element].active %}aria-current="page"{% endif %}
                >{{ nav_items[element].name }}</a>
              {% else %}
                <em class="p-side-navigation__text is-expandable u-no-margin--bottom">{{ nav_items[element].name }}</em>
              {% endif %}
              <button 
                class="p-side-navigation__expand" 
                {% if nav_items[element].expanded %}aria-expanded="true"{% endif %} 
                aria-label="show submenu for "
              ></button>
            {% endif %}
            {{ create_navigation(nav_items[element].children, previous_slug + "/" + nav_items[element].slug, expandable=nav_items[element].expanded, expanded=nav_items[element].expanded) }}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

<body id="main-content">
  <section class="p-strip">
    <div class="row">
      <aside class="col-3">
        <nav data-js="navigation" class="p-side-navigation is-sticky">
          <a href="#" class="p-side-navigation__toggle js-drawer-toggle" aria-controls="">
            Toggle side navigation
          </a>
          <div class="p-side-navigation__overlay js-drawer-toggle" aria-controls=""></div>
          <div class="p-side-navigation__drawer" id="target-id">
            <div class="p-side-navigation__drawer-header">
              <a href="#" class="p-side-navigation__toggle--in-drawer js-drawer-toggle" aria-controls="">
                Toggle side navigation
              </a>
            </div>
            {% for nav_group in navigation %}
              {% if (navigation[nav_group].name and not navigation[nav_group].name|lower == "index" and navigation[nav_group].children) 
              or (navigation[nav_group].mimeType == "document" and not navigation[nav_group].name|lower == "index") %}
                <ul class="p-side-navigation__list">
                  <li class="p-side-navigation__item">
                  {% if navigation[nav_group].mimeType == "document" %}
                    <a
                      class="p-side-navigation__link {% if navigation[nav_group].children %}is-expandable{% endif %}" 
                      {% if navigation[nav_group].active %}aria-current="page"{% endif%}
                      href="/{{previous_slug}}/{{navigation[nav_group].slug}}"
                    >{{ navigation[nav_group].name }}</a>
                  {% elif navigation[nav_group].children and navigation[nav_group].mimeType == "folder" %}
                    {% if navigation[nav_group]["children"]["index"] %}
                      <a 
                        class="p-side-navigation__link is-expandable u-no-margin--bottom" 
                        href="/{{navigation[nav_group].slug}}" 
                        {% if navigation[nav_group].active %}aria-current="page"{% endif %}
                      >{{ navigation[nav_group].name }}</a>
                    {% else %}
                      <em class="p-side-navigation__text is-expandable u-no-margin--bottom"
                      >{{ navigation[nav_group].name }}</em>
                    {% endif %}
                    <button  
                      class="p-side-navigation__expand" 
                      {% if navigation[nav_group].expanded %}aria-expanded="true"{% endif %} 
                      aria-label="show submenu for "
                    ></button>
                  {% endif %}
                  {{ create_navigation(navigation[nav_group].children, navigation[nav_group].slug, expandable=True,
                  expanded=navigation[nav_group].expanded) }}
                  </li>
                </ul>
              {% elif navigation[nav_group].mimeType == "document" and navigation[nav_group].name|lower == "index" %}
                <div class="p-side-navigation__primary-heading">
                  <a class="p-side-navigation__link p-muted-heading" {% if navigation[nav_group].active %}aria-current="page"{% endif%} href="/"><strong>{{root_name}}</strong></a>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </nav>
      </aside>
      <main class="col-7 col-medium-4">
        {% if document["breadcrumbs"]|length > 1 %}
        <nav class="p-breadcrumbs" aria-label="Breadcrumbs">
          <ol class="p-breadcrumbs__items">
            {% for page in document["breadcrumbs"] %}
            <li class="p-breadcrumbs__item">
              {% if not loop.last %}
              <a href="{{ page.path }}">{{ page.name }}</a>
              {% else %}
                {{ page.name }}
              {% endif %}
            </li>
            {% endfor %}
          </ol>
        </nav>
        {% endif %}

        {{ html | safe }}

        <hr>
        <a href="https://docs.google.com/document/d/{{document.id}}">Suggest changes&nbsp;&rsaquo;</a>
      </main>
      <aside class="col-2 col-medium-2">
        <div class="p-table-of-contents is-sticky">
          <div class="p-table-of-contents__section">
            {% if document["metadata"]["type"] %}
              <div class="u-sv2">
                {% with document_type = document["metadata"]["type"] %}
                  {% include "partial/_doc-type.html" %}
                {% endwith%}
              </div>
              <hr>
            {% endif %}
            {% if document["headings_map"] %}
              <nav class="p-table-of-contents__nav" aria-label="Table of contents">
                <h2 class="p-table-of-contents__header">Contents</h2>
                {% set ns = namespace(parent_active=False) %}
                <ul class="p-list u-no-margin--left">
                {% for heading in document["headings_map"] %}
                  {% if heading.level == 2 %}
                    {% if ns.parent_active %}
                      </ul>
                    </li>
                    {% endif %}
                    <li class="p-list__item u-no-padding">
                      <a class="p-table-of-contents__link" href="#{{ heading.id }}">{{ heading.name }}</a>
                      <ul class="p-list" style="margin-left: 0.5rem">
                    {% set ns.parent_active = true %}
                  {% else %}
                    <li class="p-list__item u-no-padding"><a class="p-table-of-contents__link" href="#{{ heading.id }}">{{ heading.name }}</a></li>
                  {% endif %}
                {% endfor %}
                {% if ns.parent_active %}
                  </ul>
                </li>
                {% endif %}
                </ul>
                <hr>
              </nav>
            {% endif %}
            <p>
              <a href="https://docs.google.com/document/d/{{document["id"]}}">
                Suggest changes&nbsp;&rsaquo;
              </a>
            </p>

            {% if document["metadata"]["review_date"] %}
            <p>Requires review: {{document["metadata"]["review_date"]}}, by {{document["metadata"]["authors"] or "Unknown"}}</p>
            {% endif %}
          </div>
        </div>
      </aside>
    </div>
  </section>
</body>

{% endblock %}
