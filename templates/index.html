{% extends 'base_layout.html' %}
{% block title %}Canonical Reference Library | Canonical{% endblock %}

{% block description %}
Canonical Reference Library is single source of information for all corporate knowledge with Canonical
{% endblock %}

{% block meta_copydoc %}{% endblock %}

{% block content %}
{% macro create_navigation(nav_items, previous_slug, expandable=False, expanded=False) %}
  {% if nav_items %}
    <ul class="p-side-navigation__list" {% if expanded %}aria-expanded="true"{% endif %}>
      {% for element in nav_items %}
        {% if (nav_items[element].mimeType == "document" and not nav_items[element].name|lower == "index") or (nav_items[element].children and nav_items[element].mimeType == "folder") %}
          <li class="p-side-navigation__item">
            {% if nav_items[element].mimeType == "document" %}
              <a
                class="p-side-navigation__link {% if nav_items[element].children %}is-expandable{% endif %}" {% if nav_items[element].active %}aria-current="page"{% endif %}
                href="/{{previous_slug}}/{{nav_items[element].slug}}"
              >{{ nav_items[element].name }}</a>
            {% elif nav_items[element].children %}
              {% if nav_items[element]["children"]["index"] %}
                <a 
                  class="p-side-navigation__link is-expandable u-no-margin--bottom" 
                  href="/{{previous_slug}}/{{nav_items[element].slug}}" 
                  {% if nav_items[element].active %}aria-current="page"{% endif %}
                >{{ nav_items[element].name }}</a>
              {% else %}
                <em class="p-side-navigation__text is-expandable u-no-margin--bottom">{{ nav_items[element].name }}</em>
              {% endif %}
              <button 
                class="p-side-navigation__expand" 
                {% if nav_items[element].expanded %}aria-expanded="true"{% endif %} 
                aria-label="show submenu for "
              ></button>
            {% endif %}
            {{ create_navigation(nav_items[element].children, previous_slug + "/" + nav_items[element].slug, expandable=nav_items[element].expanded, expanded=nav_items[element].expanded) }}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

<aside class="l-full-width__sidebar">
  <nav id="navigation" class="p-side-navigation is-sticky">
    <div class="u-fixed-width">
      <a href="#" class="p-side-navigation__toggle u-no-margin--bottom js-drawer-toggle" aria-controls="">
        Toggle side navigation
      </a>
    </div>
    <div class="p-side-navigation__overlay js-drawer-toggle" aria-controls="side-navigation-drawer" aria-expanded="false"></div>
    <div class="p-side-navigation__drawer">
      <div class="p-strip is-shallow">
        <div class="p-side-navigation__drawer-header">
          <a href="#" class="p-side-navigation__toggle--in-drawer js-drawer-toggle" aria-controls="">
            Toggle side navigation
          </a>
        </div>
        {% for nav_group in navigation %}
          {% if (navigation[nav_group].name and not navigation[nav_group].name|lower == "index" and navigation[nav_group].children) 
          or (navigation[nav_group].mimeType == "document" and not navigation[nav_group].name|lower == "index") %}
            <ul class="p-side-navigation__list">
              <li class="p-side-navigation__item">
              {% if navigation[nav_group].mimeType == "document" %}
                <a
                  class="p-side-navigation__link {% if navigation[nav_group].children %}is-expandable{% endif %}" 
                  {% if navigation[nav_group].active %}aria-current="page"{% endif%}
                  href="/{{previous_slug}}/{{navigation[nav_group].slug}}"
                >{{ navigation[nav_group].name }}</a>
              {% elif navigation[nav_group].children and navigation[nav_group].mimeType == "folder" %}
                {% if navigation[nav_group]["children"]["index"] %}
                  <a 
                    class="p-side-navigation__link is-expandable u-no-margin--bottom" 
                    href="/{{navigation[nav_group].slug}}" 
                    {% if navigation[nav_group].active %}aria-current="page"{% endif %}
                  >{{ navigation[nav_group].name }}</a>
                {% else %}
                  <em class="p-side-navigation__text is-expandable u-no-margin--bottom"
                  >{{ navigation[nav_group].name }}</em>
                {% endif %}
                <button  
                  class="p-side-navigation__expand" 
                  {% if navigation[nav_group].expanded %}aria-expanded="true"{% endif %} 
                  aria-label="show submenu for "
                ></button>
              {% endif %}
              {{ create_navigation(navigation[nav_group].children, navigation[nav_group].slug, expandable=True,
              expanded=navigation[nav_group].expanded) }}
              </li>
            </ul>
          {% elif navigation[nav_group].mimeType == "document" and navigation[nav_group].name|lower == "index" %}
            <div class="p-side-navigation__primary-heading">
              <a class="p-side-navigation__link p-muted-heading" {% if navigation[nav_group].active %}aria-current="page"{% endif%} href="/"><strong>{{root_name}}</strong></a>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </nav>
</aside>
<div class="l-full-width">
  <main class="l-main p-strip is-shallow">
    <div class="row">
      <div class="col-9">
        {% if document["breadcrumbs"]|length > 1 %}
          {% with page_list = document["breadcrumbs"] %}
            {% include "_partial/_breadcrumbs.html" %}
          {% endwith %}
        {% endif %}

        {{ html | safe }}

        <hr>
        <a href="https://docs.google.com/document/d/{{document.id}}">Suggest changes&nbsp;&rsaquo;</a>
      </div>
      <aside class="col-3">
        {% with document = document %}
          {% include "_partial/_table-of-content.html" %}
        {% endwith %}
      </aside>
    </div>
  </main>
</div>


{% endblock %}
